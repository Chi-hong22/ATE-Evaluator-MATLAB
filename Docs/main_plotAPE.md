
# `main_plotAPE.m` 模块文档

## 1. 模块概述

`main_plotAPE.m` 是一个专门用于绘制和对比两种SLAM算法在XY平面上的绝对位姿误差 (Absolute Pose Error, APE) 的入口脚本。该脚本的核心功能是调用 `plotAPEComparison` 函数，生成一个包含两条轨迹、误差热力图以及误差统计信息的可视化图表。

此脚本主要用于对比两种方法（在默认配置中命名为 "NESP" 和 "Comb"）的性能，衡量它们各自的SLAM轨迹与地面真值 (Ground Truth) 之间的差异。

## 2. 功能特性

- **简单入口**: 提供一个清晰、易于配置的入口点，用户只需修改少量文件路径即可运行。
- **文件校验**: 在执行主功能前，脚本会检查所有必需的输入文件是否存在，并在文件缺失时提供明确的错误提示。
- **参数化调用**: 将文件路径、图例标签、对齐选项等参数清晰地传递给核心绘图函数 `plotAPEComparison`。
- **配置集成**: 通过 `config.g` 加载项目统一的配置，确保图表样式（如字体、颜色、尺寸）的一致性。
- **明确的输出**: 在命令行中打印执行的起止时间、文件检查状态和最终的图窗句柄，方便调试和追踪。
- **错误处理**: 使用 `try-catch` 结构捕获执行过程中的错误，并提供详细的错误信息，包括出错的文件和行号。

## 3. 核心逻辑流程

1.  **初始化**:
    - `clear; clc;` 清理工作区。
    - 打印脚本开始执行的标题和时间戳。

2.  **配置文件路径**:
    - 用户在此区域需要**手动修改**四条轨迹文件的路径：
      - `nesp_slam_path`: 第一种方法（如NESP）生成的SLAM轨迹文件。
      - `nesp_gt_path`: 对应的地面真值轨迹文件。
      - `comb_slam_path`: 第二种方法（如Comb）生成的SLAM轨迹文件。
      - `comb_gt_path`: 对应的地面真值轨迹文件。

3.  **检查文件是否存在**:
    - 将上述四个文件路径存储在一个cell数组中。
    - 遍历该数组，使用 `isfile()` 函数逐一检查每个文件是否存在。
    - 如果文件存在，打印确认信息。
    - 如果文件不存在，脚本将抛出一个错误并终止执行，提示用户哪个文件未找到。

4.  **调用绘图函数**:
    - 加载 `config()` 获取全局配置。
    - 调用核心函数 `plotAPEComparison`，并传入以下参数：
      - **轨迹文件**: 四个文件路径。
      - **`'align', true`**: 启用时间戳对齐功能，确保比较的是同一时刻的位姿。
      - **`'save', true`**: 指示函数在生成图像后自动保存到结果目录。
      - **`'legendLabels', {'NESP', 'Comb'}`**: 为图例指定标签。
      - **`'cfg', cfg`**: 传入全局配置。

5.  **完成与收尾**:
    - 如果函数成功执行，打印完成信息、图窗句柄编号和结束时间。
    - 如果在 `try` 块中发生任何错误，`catch` 块会捕获该错误，打印详细的错误信息，然后使用 `rethrow` 重新抛出该错误以中断程序。

## 4. 如何使用

1.  **准备数据**:
    - 确保您有两组对应的SLAM轨迹和地面真值轨迹文件。文件格式应为 `readTrajectory` 函数支持的格式（如TUM格式：`timestamp tx ty tz qx qy qz qw`）。

2.  **修改文件路径**:
    - 打开 `Src/main_plotAPE.m` 文件。
    - 在 "配置文件路径" 部分，将 `nesp_slam_path`, `nesp_gt_path`, `comb_slam_path`, `comb_gt_path` 的值修改为您自己的文件实际路径。

3.  **运行脚本**:
    - 在MATLAB中，直接点击 "运行" 或在命令行中输入 `main_plotAPE` 并回车。

4.  **查看结果**:
    - 脚本会生成一个图窗，其中包含：
      - 两条对齐后的SLAM轨迹和对应的地面真值轨迹。
      - 沿轨迹路径渲染的APE误差热力图（颜色表示误差大小）。
      - 一个颜色条 (colorbar) 用于解释热力图颜色对应的误差值。
      - 图例、标题和坐标轴标签。
    - 由于 `'save'` 设置为 `true`，图像会自动保存到由 `config.m` 定义的 `RESULTS_DIR_BASE` 目录下。文件名通常是基于时间戳和模块名生成的。

## 5. 注意事项

- 此脚本假定两组轨迹（例如NESP和Comb）是针对同一环境、同一时段采集的，以便进行有意义的对比。
- 时间戳对齐 (`'align', true`) 对于准确计算APE至关重要，建议始终保持开启。
- 最终图表的可视效果（如线条颜色、粗细、字体大小）可以通过修改 `config.m` 和 `plotAPEComparison.m` 函数进行定制。

## 6. 保存与导出说明（与实现一致）

- 当调用参数 `'save', true` 时，脚本会在输出目录下保存图像文件。
- 导出格式与分辨率：
  - 默认读取 `cfg.save.global.formats`（例如 `{'png','eps'}`）逐一导出；若未配置则退化为仅导出 PNG。
  - 分辨率读取 `cfg.save.global.dpi`；若未配置则退化为 `cfg.DPI`。
  - 当包含 `eps` 时，使用 `-depsc` 并推荐 `Renderer='painters'` 以输出矢量图；`dpi` 仅影响嵌入位图对象。
- 文件命名：保持当前实现 `APE_error.png/.eps` 命名，不改变现有行为。

