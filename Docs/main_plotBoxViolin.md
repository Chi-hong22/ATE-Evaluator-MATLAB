
# `main_plotBoxViolin.m`: ATE 分布对比模块

## 1. 模块概述

`main_plotBoxViolin.m` 是一个用于对比多组绝对轨迹误差 (ATE) 数据分布的入口脚本。它的核心功能是调用 `plotATEDistributions` 函数，通过**箱形图 (Box Plot)** 和**小提琴图 (Violin Plot)** 的组合，直观地展示不同算法或不同实验条件下ATE数据的统计特性。

此脚本特别适用于需要对多份ATE分析结果（通常是 `.csv` 格式的误差数据）进行横向比较的场景。

## 2. 如何使用

有多种方式可以运行此功能，最推荐的是直接编辑并运行入口脚本。

### 2.1 脚本化运行 (推荐)

如果你需要重复运行或进行自动化测试，可以直接编辑 `Src/main_plotBoxViolin.m` 脚本。

1.  **准备数据**: 确保你已经生成了ATE误差数据，并保存为单列的 `.csv` 或 `.txt` 文件。
2.  **配置脚本**: 打开 `Src/main_plotBoxViolin.m` 文件，在顶部的“用户配置区”预先定义好文件路径和对应的标签。
    ```matlab
    % --- 用户配置区 ---
    files_to_plot   = {
        'Results\250828_NESP_noINS_seed40_yaw_0.05_0.005rad\ate_details_optimized.csv',...
        'Results\250911_Comb_noINS_seed40_yaw_0.05_0.005rad_overlapcoverage_0.5\ate_details_optimized.csv'
    };
    labels_for_plot = {'NESP', 'Comb'};
    ```
3.  **运行脚本**: 在MATLAB中，直接点击 "运行" 或在命令行中输入 `main_plotBoxViolin` 回车。脚本将自动生成图表并根据配置保存。

### 2.2 交互式运行

如果您将 `files_to_plot` 设置为空的 cell 数组 `{}`，脚本将进入交互模式。

1.  运行 `main_plotBoxViolin`。
2.  程序会弹出一个文件选择窗口，让你**多选**一个或多个ATE数据文件。
3.  接着，为每个选定的文件弹出一个输入框，让你为该组数据指定一个**横坐标标签**（默认为文件名）。
4.  最终生成并保存图表。

## 3. 如何解读图表

### 3.1 箱形图 (Box Plot)

箱形图是一种标准化的方式，用于显示数据的分布情况。它着重于展示数据的关键统计摘要。

-   **中心粗线**: **中位数 (Median)**。这是数据的“中点”，50%的数据点低于此值，50%高于此值。它比均值更能抵抗异常值的影响。
-   **箱体 (Box)**:
    -   **箱底**: **下四分位数 (Q1)**，代表25%的数据点低于此值。
    -   **箱顶**: **上四分位数 (Q3)**，代表75%的数据点低于此值。
    -   **箱体高度**: **四分位距 (IQR = Q3 - Q1)**。这个高度反映了数据中心50%的点的离散程度，高度越矮，数据越集中。
-   **须线 (Whiskers)**:
    -   从箱体延伸出的上下两条线，代表了数据的绝大部分范围。通常，它们的末端位置是 `Q1 - 1.5 * IQR` 和 `Q3 + 1.5 * IQR`。
-   **叠加的散点**:
    -   我们在此图上特意叠加了每一个原始数据点（有轻微的水平抖动以防重叠）。这可以让你直观地看到数据的真实分布密度，弥补了箱线图无法展示双峰、多峰等复杂分布的缺点。

### 3.2 小提琴图 (Violin Plot)

小提琴图是箱线图和密度图的结合体，它在展示统计摘要的同时，更侧重于表现数据的**概率密度**。

-   **形状宽度**:
    -   小提琴的**宽度**代表了在该数值水平上数据点的密集程度。越宽的地方，说明数据点越集中；越窄的地方，数据点越稀疏。
    -   通过观察形状，可以轻松识别出数据是单峰、双峰还是多峰分布。对于ATE误差，通常是单峰且向高误差值方向拖着一个长长的“尾巴”（即右偏分布）。
-   **内部的黑线**:
    -   **粗实线**: **中位数 (Median)**，与箱线图的中心线意义相同。
    -   **虚线**: **均值 (Mean)**，即所有数据点的算术平均值。
-   **如何结合解读**:
    -   **对称性**: 比较中位数和均值的位置。如果均值被拉高（高于中位数），说明存在较大的误差值，分布是**右偏**的。
    -   **与散点的关系**: 叠加的散点应该与小提琴的宽度轮廓大致吻合，即点密集的地方，小提琴也应该更宽。
    -   **平底/平顶**: 如果小提琴的顶端或底端是平的，这通常代表了数据的硬性边界（例如，ATE误差最小值不可能小于0），是数据真实分布的正确反映。

通过结合这两种图表，你可以非常全面地评估和比较不同算法或参数下的ATE性能。

## 4. 函数API详解 (`plotATEDistributions`)

入口脚本 `main_plotBoxViolin.m` 内部调用了核心函数 `plotATEDistributions.m`。该函数采用 `Name-Value` 对的形式接收参数，灵活性高。

-   `'files'` (cellstr):
    -   **功能**: 指定要分析的数据文件路径列表。
    -   **示例**: `{'path/to/file1.txt', 'path/to/file2.csv'}`
    -   **默认**: `{}` (空), 将触发 `uigetfile` 弹窗让用户手动选择。

-   `'labels'` (cellstr):
    -   **功能**: 为每个文件指定一个在图表上显示的横坐标标签。
    -   **示例**: `{'Method 1', 'Method 2'}`
    -   **默认**: `{}` (空), 将使用文件名作为默认值，并弹出 `inputdlg` 让用户确认或修改。

-   `'column'` (string | double):
    -   **功能**: 当输入文件包含多列数据时，指定哪一列是ATE误差值。可以是列的**表头名** (如 `'ate_error'`) 或**列号** (如 `2`)。
    -   **自动检测逻辑**: 优先查找与 `'ate_error'` (不区分大小写) 匹配的列，其次是包含 `'ate'` 的列，如果都找不到，则默认使用文件中的**第一个数值列**。
    -   **默认**: `'ate_error'`

-   `'save'` (logical):
    -   **功能**: 控制是否保存生成的图表。
    -   **取值**: `true` (保存) 或 `false` (仅显示)。
    -   **默认**: `false`

-   `'cfg'` (struct):
    -   **功能**: 传入从 `config.m` 加载的配置结构体。这使得函数可以获取全局的 `DPI`、字体大小、图窗尺寸等样式参数。
    -   **默认**: `[]` (空), 函数会自动调用 `config()` 加载配置。

## 5. 数据格式与依赖项

-   **文件类型**: 支持 `.txt` 和 `.csv`。
-   **内容**: 文件应包含至少一列数值数据。推荐包含**表头**，并使用 `'ate_error'` 或 `'ate'` 来命名误差数据列，以便函数自动识别。
-   **依赖**: **Statistics and Machine Learning Toolbox** 是生成小提琴图所必需的。

## 6. 保存与导出说明（与实现一致）

- 当入口脚本或调用方设置 `'save', true` 时，图像按配置导出。
- 导出格式与分辨率：
  - 读取 `cfg.save.global.formats`（如 `{'png','eps'}`）逐一导出；未配置则默认仅 PNG。
  - 使用 `cfg.save.global.dpi` 作为分辨率；未配置则回退 `cfg.DPI`。
  - 当包含 `eps` 时，推荐 `Renderer='painters'` 并使用 `-depsc` 以输出矢量图；`dpi` 仅影响位图嵌入部分。
- 文件命名：与现有实现保持一致（`_ATE_error_boxplot.*`, `_ATE_error_violin.*`）。

