# 函数说明: `plotErrorDistributions.m`

本文档详细介绍了 `plotErrorDistributions.m` 函数的功能、使用方法、参数配置及注意事项。

- **版本**: 1.0.0
- **更新时间**: 2025-09-10

## 1. 功能概述

`plotErrorDistributions.m` 是一个独立的MATLAB函数，用于可视化多组ATE（绝对轨迹误差）数据的分布情况。它可以从多个数据文件（`.txt`或`.csv`）中读取误差值，并为每一组数据生成两种核心图表：

-   **箱线图 (Box Plot)**: 直观展示数据的中位数、四分位数、异常值等统计特性。
-   **小提琴/花瓶图 (Violin Plot)**: 结合了箱线图与核密度估计，能更清晰地显示数据的分布形态。

该函数与项目中的 `config.m` 无缝集成，自动应用统一的字体、分辨率和尺寸配置，确保图表风格的一致性。同时，它也支持丰富的自定义参数，如颜色、标签等，并通过入口脚本 `plotBoxViolin_main.m` 实现了交互式和脚本化两种调用方式。

## 2. 如何使用

### 2.1 交互式运行 (推荐)

最简单的方式是直接运行入口脚本 `plotBoxViolin_main.m`。

1.  在MATLAB中打开项目。
2.  在命令行窗口输入并运行：
    ```matlab
    plotBoxViolin_main
    ```
3.  程序将自动：
    -   弹出一个文件选择窗口，允许你**多选**一个或多个ATE数据文件。
    -   为每个选定的文件弹出一个输入框，让你为该组数据指定一个**横坐标标签**（默认为文件名）。
    -   生成箱线图和小提琴图。
    -   根据 `config.m` 的设置，将生成的PNG图像自动保存到带时间戳的 `Results` 文件夹中。

### 2.2 脚本化运行

如果你需要重复运行或进行自动化测试，可以直接编辑 `plotBoxViolin_main.m` 脚本，在顶部的“用户配置区”预先定义好文件路径和标签。

```matlab
% --- 编辑 Src/plotBoxViolin_main.m ---
...
files_to_plot   = {
    'Data\poses_corrupted_ate.csv', ...
    'Data\poses_optimized_ate.csv'
};
labels_for_plot = {'Before Optimization', 'After Optimization'};
...
```

修改保存后，直接运行 `plotBoxViolin_main` 即可生成对应的图表，无需任何手动操作。

### 2.3 终端命令行调用

你也可以通过终端（如PowerShell, Bash）的 `matlab -batch` 命令直接运行。

```powershell
# 方式一: 运行入口脚本 (交互式)
matlab -batch "run('Src/plotBoxViolin_main.m')"

# 方式二: 直接调用核心函数 (非交互式, 需提供完整参数)
matlab -batch "plotErrorDistributions('files',{'Data/ate_A.csv'}, 'labels',{'Group A'}, 'save',true)"
```

## 3. 函数API详解 (`plotErrorDistributions.m`)

`function fig_handles = plotErrorDistributions(varargin)`

该函数采用 `Name-Value` 对的形式接收参数，灵活性高。

### 主要参数

-   `'files'` (cellstr):
    -   **功能**: 指定要分析的数据文件路径列表。
    -   **示例**: `{'path/to/file1.txt', 'path/to/file2.csv'}`
    -   **默认**: `{}` (空), 将触发 `uigetfile` 弹窗让用户手动选择。

-   `'labels'` (cellstr):
    -   **功能**: 为每个文件指定一个在图表上显示的横坐标标签。
    -   **示例**: `{'Method 1', 'Method 2'}`
    -   **默认**: `{}` (空), 将使用文件名作为默认值，并弹出 `inputdlg` 让用户确认或修改。

-   `'column'` (string | double):
    -   **功能**: 当输入文件包含多列数据时，指定哪一列是ATE误差值。可以是列的**表头名** (如 `'ate_error'`) 或**列号** (如 `2`)。
    -   **自动检测逻辑**: 优先查找与 `'ate_error'` (不区分大小写) 匹配的列，其次是包含 `'ate'` 的列，如果都找不到，则默认使用文件中的**第一个数值列**。
    -   **默认**: `'ate_error'`

-   `'save'` (logical):
    -   **功能**: 控制是否保存生成的图表。
    -   **取值**: `true` (保存) 或 `false` (仅显示)。
    -   **默认**: `false`

-   `'outputDir'` (string):
    -   **功能**: 指定图表保存的目录。
    -   **默认**: `''` (空), 将自动在 `config.m` 指定的 `RESULTS_DIR_BASE` 目录下创建一个带时间戳的子文件夹 (例如 `Results/20250910_153000_distributions/`)。

-   `'cfg'` (struct):
    -   **功能**: 传入从 `config.m` 加载的配置结构体。这使得函数可以获取全局的 `DPI`、字体大小、图窗尺寸等样式参数。
    -   **默认**: `[]` (空), 函数会自动调用 `config()` 加载配置。

### 次要参数

-   `'colors'` (Nx6 double):
    -   **功能**: 自定义颜色方案。每行代表一组，前3列为填充色(RGB)，后3列为边框色(RGB)。
    -   **默认**: 使用函数内置的5组预定义颜色。

## 4. 数据格式要求

-   **文件类型**: 支持 `.txt` 和 `.csv`。
-   **内容**:
    -   文件应包含至少一列数值数据。
    -   推荐包含**表头**，并使用 `'ate_error'` 或 `'ate'` 来命名误差数据列，以便函数自动识别。
    -   如果文件无表头且包含多列，请使用 `'column'` 参数指定列号。
    -   非数值行和 `NaN`/`Inf` 值会被自动忽略。

**示例 `ate_data.csv`:**
```csv
timestamp,ate_error,other_metric
0.0,0.123,9.8
0.1,0.125,9.7
0.2,0.128,9.9
...
```

## 5. 依赖项

-   **必需**: **Statistics and Machine Learning Toolbox**
    -   此工具箱是 `ksdensity` 函数所必需的，该函数是生成小提琴图的核心。如果缺少此工具箱，函数将无法正常运行。

-   **推荐**: MATLAB **R2020a** 或更高版本
    -   新版本支持 `boxchart` 函数，其视觉效果和定制性优于旧版的 `boxplot`。函数已做兼容性处理，在旧版MATLAB中会自动回退使用 `boxplot`。

## 6. 注意事项

-   **路径问题**: 从终端调用时，请确保MATLAB的当前工作目录在项目根目录，或使用绝对路径指定文件。
-   **颜色循环**: 函数内置了5组颜色方案。如果输入超过5组数据，颜色将会循环使用。
-   **性能**: 对于包含超大量数据点（如超过10万点）的文件，小提琴图的核密度计算和散点渲染可能会消耗较长时间。

## 7. 如何解读图表

### 7.1 箱线图 (Box Plot)

箱线图是一种标准化的方式，用于显示数据的分布情况。它着重于展示数据的关键统计摘要。

-   **中心粗线**: **中位数 (Median)**。这是数据的“中点”，50%的数据点低于此值，50%高于此值。它比均值更能抵抗异常值的影响。
-   **箱体 (Box)**:
    -   **箱底**: **下四分位数 (Q1)**，代表25%的数据点低于此值。
    -   **箱顶**: **上四分位数 (Q3)**，代表75%的数据点低于此值。
    -   **箱体高度**: **四分位距 (IQR = Q3 - Q1)**。这个高度反映了数据中心50%的点的离散程度，高度越矮，数据越集中。
-   **须线 (Whiskers)**:
    -   从箱体延伸出的上下两条线，代表了数据的绝大部分范围。通常，它们的末端位置是 `Q1 - 1.5 * IQR` 和 `Q3 + 1.5 * IQR`。
-   **叠加的散点**:
    -   我们在此图上特意叠加了每一个原始数据点（有轻微的水平抖动以防重叠）。这可以让你直观地看到数据的真实分布密度，弥补了箱线图无法展示双峰、多峰等复杂分布的缺点。

### 7.2 小提琴图 (Violin Plot)

小提琴图是箱线图和密度图的结合体，它在展示统计摘要的同时，更侧重于表现数据的**概率密度**。

-   **形状宽度**:
    -   小提琴的**宽度**代表了在该数值水平上数据点的密集程度。越宽的地方，说明数据点越集中；越窄的地方，数据点越稀疏。
    -   通过观察形状，可以轻松识别出数据是单峰、双峰还是多峰分布。对于ATE误差，通常是单峰且向高误差值方向拖着一个长长的“尾巴”（即右偏分布）。
-   **内部的黑线**:
    -   **粗实线**: **中位数 (Median)**，与箱线图的中心线意义相同。
    -   **虚线**: **均值 (Mean)**，即所有数据点的算术平均值。
-   **如何结合解读**:
    -   **对称性**: 比较中位数和均值的位置。如果均值被拉高（高于中位数），说明存在较大的误差值，分布是**右偏**的。
    -   **与散点的关系**: 叠加的散点应该与小提琴的宽度轮廓大致吻合，即点密集的地方，小提琴也应该更宽。
    -   **平底/平顶**: 如果小提琴的顶端或底端是平的，这通常代表了数据的硬性边界（例如，ATE误差最小值不可能小于0），是数据真实分布的正确反映。

通过结合这两种图表，你可以非常全面地评估和比较不同算法或参数下的ATE性能。
